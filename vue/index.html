<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
  </head>
  <body>
    <div id="app"></div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
<script type="module">
let title = import.meta.env.VITE_WEB_TITLE;
let titleDom = document.getElementsByTagName('title')[0];
titleDom.innerHTML = title;
</script>
<!-- 引入高德地图2.0版本API -->
<script src="https://webapi.amap.com/maps?v=2.0&key=c7c5f356a92dd637019b282508b001a3&plugin=AMap.Geocoder"></script>

<div id="app">
  <button id="btn">获取地址</button>
  <p id="result"></p>
</div>

<script>
  // 等待高德地图API加载完成
  window.onload = () => {
    const btn = document.getElementById('btn')
    const resultEl = document.getElementById('result')

    btn.onclick = async () => {
      try {
        // 确保插件加载完成
        await new Promise((resolve) => {
          AMap.plugin('AMap.Geocoder', () => {
            resolve()
          })
        })

        const geocoder = new AMap.Geocoder()

        const lnglat = [107.97, 22.62] // 经度, 纬度

        geocoder.getAddress(lnglat, (status, result) => {
          if (status === 'complete' && result.regeocode) {
            const address = result.regeocode.formattedAddress
            console.log('逆地理编码地址:', address)
            resultEl.innerText = '地址：' + address
          } else {
            console.error('获取地址失败', status, result)
            resultEl.innerText = '获取地址失败'
          }
        })
      } catch (e) {
        console.error('异常:', e)
        resultEl.innerText = '异常：' + e.message
      }
    }
  }
</script>
